<!-- Bills view -->

<div class="col-lg-12">
  <div class="clearfix">
    <h1 class="pull-left">Bills</h1>
    <div class="pull-right alert alert-success" ng-show="success">{{successmsg}}</div>
    <div class="pull-right alert alert-danger" ng-show="error">{{errormsg}}</div>
  </div>
  <hr>

	<button class="btn btn-success pull-right" data-toggle="modal" data-target="#addModal">Add Bill</button>

	<!-- Add bill modal -->
	<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	        <h4 class="modal-title" id="myModalLabel">Add Bill</h4>
	      </div>

	      <div class="modal-body">
			    <form class="form-horizontal" role="form">
			      <div class="form-group">
			        <label class="col-sm-2 control-label">Name</label>
			        <div class="col-sm-6">
			          <input type="text" class="form-control" ng-model="bill.name" placeholder="Rent">
			        </div>
			      </div>
			      <div class="form-group">
			        <label class="col-sm-2 control-label">Amount</label>
			         <div class="col-sm-6">
                <div class="input-group">
                  <span class="input-group-addon">$</span>
			            <input type="number" class="form-control" ng-model="bill.total">
                </div>
			        </div>
			      </div>
			      <div class="form-group">
			        <label class="col-sm-2 control-label">Date</label>
			        <div class="col-sm-6">
			          <input type="date" class="form-control" ng-model="bill.date">
			        </div>
			      </div>
			      <div class="form-group">
			        <label class="col-sm-2 control-label">Frequency</label>
			        <div class="col-sm-6">
					      <input type="radio" name="interval" value="0" ng-model="bill.interval">One-Time 
					      <input type="radio" name="interval" value="3" ng-model="bill.interval">Monthly
			        </div>
			      </div>
			      <div class="form-group">
			        <label class="col-sm-2 control-label">Responsible</label>
			        <div class="col-sm-6">
					      <ul class="list-unstyled" ng-repeat="roommate in roommates">
					        <li>
                    <input type="checkbox" value={{roommate.id}} ng-click="toggleSelection(roommate.id)"> {{roommate.first_name}} {{roommate.last_name}}
                    <div class="input-group">
                      <span class="input-group-addon">$</span>
                      <input type="number" class="form-control" ng-model="roommate.amount">
                    </div>
                  </li>
					      </ul>
			        </div>
			      </div>
			    </form>
        </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="reset()">Cancel</button>
	        <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="addBill()">Add</button>
	      </div>

	    </div>
	  </div>
	</div>

	<!-- Bill table -->
	<!-- add a filter to table later on -->
	<div class="clearfix" id="bill-filter">
		<div class="btn-group">
		  <button type="button" class="btn btn-default" ng-click="setTable('unresolved')" ng-class="{ 'active' : table === 'unresolved' }">Unresolved</button>			
		  <button type="button" class="btn btn-default" ng-click="setTable('resolved')" ng-class="{ 'active' : table === 'resolved' }">Resolved</button>
		</div>
	</div>
	<table ng-show="!emptyBillList()" class="table table-striped table-hover clearfix text-center" id="bill-table">
		<!-- Table Header -->
		<tr>
			<th class="text-center">Bill</th>
			<th class="text-center">Total</th>
			<th class="text-center">Owed</th>
			<th class="text-center">Pay to</th>
			<th class="text-center">Due</th>
			<th class="text-center">Paid?</th>
			<th class="text-center">Delete</th>
		</tr>

		<tr ng-repeat="bill in bills">
			<td data-toggle="modal" data-target="#editModal" ng-click="prepareUpdate(bill.id, $index)">{{bill.name}}</td>
			<td data-toggle="modal" data-target="#editModal" ng-click="prepareUpdate(bill.id, $index)">${{bill.amount}}</td>
			<td data-toggle="modal" data-target="#editModal" ng-click="prepareUpdate(bill.id, $index)">${{amountOwed(bill.id, $index)}}</td>
			<td data-toggle="modal" data-target="#editModal" ng-click="prepareUpdate(bill.id, $index)">{{bill.payTo}}</td>
			<td data-toggle="modal" data-target="#editModal" ng-click="prepareUpdate(bill.id, $index)">{{format(bill.dueDate)}}</td>
			<td><input type="checkbox" ng-click="payBill(bill.id, $index)" ng-checked="isPaid(bill.id, $index)"></td>
			<td><i class="ion-close-circled delete-icon" data-toggle="modal" data-target="#deleteModal" ng-click="prepareDelete(bill.id, $index)" ng-show="isOwner(bill.id)"></i></td>
		</tr>
	</table>

	<!-- Delete Confirmation modal -->
	<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
		    <div class="modal-body">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	        <h4 class="modal-title" id="myModalLabel">Are you sure you want to delete this bill?</h4>
	      </div>
		    <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="resetDelete()">Cancel</button>
	        <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteBill()">Delete</button>    
	      </div>
	    </div>
	  </div>
	</div>		

	<!-- Edit bill modal -->
	<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	        <h4 class="modal-title" id="myModalLabel">Edit Bill</h4>
	      </div>

	      <div class="modal-body">
		    <form class="form-horizontal" role="form">
		      <div class="form-group">
		        <label class="col-sm-2 control-label">Name</label>
		        <div class="col-sm-6">
		          <input type="text" class="form-control" ng-model="oldBill.name">
		        </div>
		      </div>
		      <div class="form-group">
		        <label class="col-sm-2 control-label">Amount</label>
		        <div class="col-sm-6">
            <div class="input-group">
              <span class="input-group-addon">$</span>
              <input type="text" class="form-control" ng-model="oldBill.amount">
            </div>
		        </div>
		      </div>
		      <div class="form-group">
		        <label class="col-sm-2 control-label">Date</label>
		        <div class="col-sm-6">
		          <input type="date" class="form-control" ng-model="oldBill.dueDate">
		        </div>
		      </div>
		      <div class="form-group">
		        <label class="col-sm-2 control-label">Frequency</label>
		        <div class="col-sm-6">
				      <input type="radio" name="frequency" value="0" ng-model="oldBill.frequency">One-Time 
				      <input type="radio" name="frequency" value="3" ng-model="oldBill.frequency">Monthly
		        </div>
		      </div>
		      <div class="form-group">
		        <label class="col-sm-2 control-label">Responsible</label>
		        <div class="col-sm-6">
				      <ul class="list-unstyled" ng-repeat="roommate in roommates">
				        <li>
                <input type="checkbox" value={{roommate.id} ng-click="toggleSelection(roommate.id)" ng-checked="isChecked(roommate.id)">{{roommate.first_name}} {{roommate.last_name}}
                <div class="input-group">
                  <span class="input-group-addon">$</span>
                  <input type="text" class="form-control" ng-model="updatedAmount[$index].amount">
                </div>
              	</li>
				      </ul>
		        </div>
		      </div>
		    </form>
	      </div>

	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="reset()">Cancel</button>
	        <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="updateBill()">Update</button>
	      </div>

	    </div>
	  </div>
	</div>

	<!-- Roommates balance table -->
	<h3>Balance</h3>
	<table class="table table-hover table-striped text-center">
		<tr>
			<th class="text-center">Roommate</th>
			<th class="text-center">Owed to them</th>
			<th class="text-center">They owe you</th>
			<th class="text-center">Net Balance</th>
		</tr>
		<tr ng-repeat="balance in balances">
			<td>{{balance.first_name}} {{balance.last_name}}</td>
			<td>${{balance.userOwed}}</td>
			<td>${{balance.owedToUser}}</td>
			<td>${{balance.netBalance}}</td>
		</tr>
	</table>

	<div class="alert alert-warning" ng-show="emptyBillList()">No bills here, add some!</div>

</div>
